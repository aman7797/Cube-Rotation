// Generated by purs version 0.11.7
"use strict";
var Control_Applicative = require("../Control.Applicative");
var Control_Bind = require("../Control.Bind");
var Control_Monad_Aff = require("../Control.Monad.Aff");
var Control_Monad_Eff_Class = require("../Control.Monad.Eff.Class");
var Control_Monad_Eff_Console = require("../Control.Monad.Eff.Console");
var Control_Monad_State_Class = require("../Control.Monad.State.Class");
var Control_Semigroupoid = require("../Control.Semigroupoid");
var Data_Array = require("../Data.Array");
var Data_EuclideanRing = require("../Data.EuclideanRing");
var Data_Function = require("../Data.Function");
var Data_Functor = require("../Data.Functor");
var Data_Maybe = require("../Data.Maybe");
var Data_Ring = require("../Data.Ring");
var Data_Semigroup = require("../Data.Semigroup");
var Data_Semiring = require("../Data.Semiring");
var Data_Show = require("../Data.Show");
var Data_Tuple = require("../Data.Tuple");
var Halogen = require("../Halogen");
var Halogen_Component = require("../Halogen.Component");
var Halogen_HTML = require("../Halogen.HTML");
var Halogen_HTML_Core = require("../Halogen.HTML.Core");
var Halogen_HTML_Elements = require("../Halogen.HTML.Elements");
var Halogen_HTML_Events = require("../Halogen.HTML.Events");
var Halogen_HTML_Properties = require("../Halogen.HTML.Properties");
var Halogen_Query_HalogenM = require("../Halogen.Query.HalogenM");
var $$Math = require("../Math");
var Prelude = require("../Prelude");
var Svg_Attributes = require("../Svg.Attributes");
var Svg_Elements = require("../Svg.Elements");
var X = (function () {
    function X() {

    };
    X.value = new X();
    return X;
})();
var Y = (function () {
    function Y() {

    };
    Y.value = new Y();
    return Y;
})();
var Z = (function () {
    function Z() {

    };
    Z.value = new Z();
    return Z;
})();
var Tick = (function () {
    function Tick(value0) {
        this.value0 = value0;
    };
    Tick.create = function (value0) {
        return new Tick(value0);
    };
    return Tick;
})();
var IncAngVelocity = (function () {
    function IncAngVelocity(value0, value1) {
        this.value0 = value0;
        this.value1 = value1;
    };
    IncAngVelocity.create = function (value0) {
        return function (value1) {
            return new IncAngVelocity(value0, value1);
        };
    };
    return IncAngVelocity;
})();
var ForwardToggle = (function () {
    function ForwardToggle(value0) {
        this.value0 = value0;
    };
    ForwardToggle.create = function (value0) {
        return new ForwardToggle(value0);
    };
    return ForwardToggle;
})();
var VelocityIncrement = (function () {
    function VelocityIncrement(value0) {
        this.value0 = value0;
    };
    VelocityIncrement.create = function (value0) {
        return new VelocityIncrement(value0);
    };
    return VelocityIncrement;
})();
var VelocityDecrement = (function () {
    function VelocityDecrement(value0) {
        this.value0 = value0;
    };
    VelocityDecrement.create = function (value0) {
        return new VelocityDecrement(value0);
    };
    return VelocityDecrement;
})();
var AddCube = (function () {
    function AddCube(value0) {
        this.value0 = value0;
    };
    AddCube.create = function (value0) {
        return new AddCube(value0);
    };
    return AddCube;
})();
var RemoveCube = (function () {
    function RemoveCube(value0) {
        this.value0 = value0;
    };
    RemoveCube.create = function (value0) {
        return new RemoveCube(value0);
    };
    return RemoveCube;
})();
var viewBoxSize = 600.0;
var viewCenter = {
    x: viewBoxSize / 2.0,
    y: viewBoxSize / 2.0
};
var rotate = function (v) {
    var rotateInPlane = function (axis1) {
        return function (axis2) {
            return function (ang) {
                return new Data_Tuple.Tuple(axis1 * $$Math.cos(ang) - axis2 * $$Math.sin(ang), axis2 * $$Math.cos(ang) + axis1 * $$Math.sin(ang));
            };
        };
    };
    var rotateX = function (ang) {
        return function (v1) {
            var v2 = rotateInPlane(v1.y)(v1.z)(ang);
            return {
                x: v1.x,
                y: v2.value0,
                z: v2.value1
            };
        };
    };
    var rotateY = function (ang) {
        return function (v1) {
            var v2 = rotateInPlane(v1.x)(v1.z)(ang);
            return {
                x: v2.value0,
                y: v1.y,
                z: v2.value1
            };
        };
    };
    var rotateZ = function (ang) {
        return function (v1) {
            var v2 = rotateInPlane(v1.x)(v1.y)(ang);
            return {
                x: v2.value0,
                y: v2.value1,
                z: v1.z
            };
        };
    };
    return function ($162) {
        return rotateZ(v.za)(rotateY(v.ya)(rotateX(v.xa)($162)));
    };
};
var rotateShape = function (vertices) {
    return function (ang) {
        return Data_Functor.map(Data_Functor.functorArray)(rotate(ang))(vertices);
    };
};
var renderView = function (state) {
    var renderButton = function (label) {
        return function (query) {
            return Halogen_HTML_Elements.button([ Halogen_HTML_Properties.title(label), Halogen_HTML_Events.onClick(Halogen_HTML_Events.input_(query)) ])([ Halogen_HTML_Core.text(label) ]);
        };
    };
    var project = function (p) {
        return {
            x: p.x + viewCenter.x,
            y: p.y + viewCenter.y
        };
    };
    var getPoint = function (maybePoint) {
        var $$default = {
            x: 100.0,
            y: 100.0
        };
        return Data_Maybe.fromMaybe($$default)(maybePoint);
    };
    var drawVertex = function (idx) {
        return function (v) {
            return Svg_Elements.g([  ])([ Svg_Elements.text([ Svg_Attributes.x(v.x + 5.0), Svg_Attributes.y(v.y - 5.0), Svg_Attributes.fill(new Data_Maybe.Just(new Svg_Attributes.RGB(150, 150, 150))) ])([ Halogen_HTML_Core.text(Data_Show.show(Data_Show.showInt)(idx)) ]), Svg_Elements.circle([ Svg_Attributes.r(3.0), Svg_Attributes.cx(v.x), Svg_Attributes.cy(v.y), Svg_Attributes.fill(new Data_Maybe.Just(new Svg_Attributes.RGB(100, 100, 100))) ]) ]);
        };
    };
    var drawVertices = function (vert2Ds) {
        return Data_Array.mapWithIndex(drawVertex)(vert2Ds);
    };
    var drawLine = function (a) {
        return function (b) {
            return Svg_Elements.path([ Svg_Attributes.d([ new Svg_Attributes.Abs(new Svg_Attributes.M(a.x, a.y)), new Svg_Attributes.Abs(new Svg_Attributes.L(b.x, b.y)) ]), Svg_Attributes.stroke(new Data_Maybe.Just(new Svg_Attributes.RGB(50, 50, 50))) ]);
        };
    };
    var drawEdges = function (edges) {
        return function (verts) {
            var connectedVerts = Data_Functor.map(Data_Functor.functorArray)(function (v) {
                return new Data_Tuple.Tuple(Data_Array.index(verts)(v.value0), Data_Array.index(verts)(v.value1));
            })(edges);
            return Data_Functor.map(Data_Functor.functorArray)(function (v) {
                return drawLine(getPoint(v.value0))(getPoint(v.value1));
            })(connectedVerts);
        };
    };
    var drawCube = function (edges) {
        return function (vert2Ds) {
            return Data_Semigroup.append(Data_Semigroup.semigroupArray)(drawEdges(edges)(vert2Ds))(drawVertices(vert2Ds));
        };
    };
    var vert2Ds = Data_Functor.map(Data_Functor.functorArray)(project)(state.shape.vertices);
    return Halogen_HTML_Elements.div([  ])(Data_Semigroup.append(Data_Semigroup.semigroupArray)([ renderButton("rotX++")(IncAngVelocity.create(X.value)), renderButton("rotY++")(IncAngVelocity.create(Y.value)), renderButton("rotZ++")(IncAngVelocity.create(Z.value)), Halogen_HTML_Core.text(Data_Show.show(Data_Show.showBoolean)(state.forward)), renderButton("change-dir")(ForwardToggle.create), renderButton("Vel++")(VelocityIncrement.create), renderButton("Vel--")(VelocityDecrement.create), Halogen_HTML_Core.text(Data_Show.show(Data_Show.showNumber)(state.speed)), renderButton("AddCuber")(AddCube.create), renderButton("RemoveCube ")(RemoveCube.create) ])([ Svg_Elements.svg([ Svg_Attributes.viewBox(0.0)(0.0)(viewBoxSize)(viewBoxSize) ])([ Svg_Elements.g([  ])(drawCube(state.shape.edges)(vert2Ds)) ]) ]));
};
var oneDegInRad = 1.745329255e-2;
var tenDegInRad = oneDegInRad * 10.0;
var initCube = {
    shape: {
        vertices: [ {
            x: 100.0,
            y: 100.0,
            z: 100.0
        }, {
            x: -100.0,
            y: 100.0,
            z: 100.0
        }, {
            x: 100.0,
            y: -100.0,
            z: 100.0
        }, {
            x: -100.0,
            y: -100.0,
            z: 100.0
        }, {
            x: 100.0,
            y: 100.0,
            z: -100.0
        }, {
            x: -100.0,
            y: 100.0,
            z: -100.0
        }, {
            x: 100.0,
            y: -100.0,
            z: -100.0
        }, {
            x: -100.0,
            y: -100.0,
            z: -100.0
        } ],
        edges: [ new Data_Tuple.Tuple(0, 1), new Data_Tuple.Tuple(0, 2), new Data_Tuple.Tuple(0, 4), new Data_Tuple.Tuple(1, 5), new Data_Tuple.Tuple(1, 3), new Data_Tuple.Tuple(2, 3), new Data_Tuple.Tuple(2, 6), new Data_Tuple.Tuple(4, 5), new Data_Tuple.Tuple(4, 6), new Data_Tuple.Tuple(3, 7), new Data_Tuple.Tuple(6, 7), new Data_Tuple.Tuple(5, 7) ]
    },
    angVel: {
        xa: tenDegInRad,
        ya: tenDegInRad,
        za: tenDegInRad
    },
    forward: true,
    speed: 1.0,
    count: 1.0
};
var frameRate = 200.0;
var dampenPercent = 1.0 - 0.9 / frameRate;
var dampenAngVelocity = function (v) {
    var dampen = function (ang) {
        return ang * dampenPercent;
    };
    return {
        xa: dampen(v.xa),
        ya: dampen(v.ya),
        za: dampen(v.za)
    };
};
var anglePerFrame = function (v) {
    return {
        xa: v.xa / frameRate,
        ya: v.ya / frameRate,
        za: v.za / frameRate
    };
};
var accelerateBy = oneDegInRad * 50.0;
var cubes = (function () {
    var $$eval = function (v) {
        if (v instanceof Tick) {
            return Control_Bind.bind(Halogen_Query_HalogenM.bindHalogenM)(Control_Monad_State_Class.get(Halogen_Query_HalogenM.monadStateHalogenM))(function (v1) {
                var newShape = {
                    edges: v1.shape.edges,
                    vertices: rotateShape(v1.shape.vertices)(anglePerFrame(v1.angVel))
                };
                var newCube = (function () {
                    var $84 = {};
                    for (var $85 in v1) {
                        if ({}.hasOwnProperty.call(v1, $85)) {
                            $84[$85] = v1[$85];
                        };
                    };
                    $84.angVel = dampenAngVelocity(v1.angVel);
                    $84.shape = newShape;
                    return $84;
                })();
                return Control_Bind.discard(Control_Bind.discardUnit)(Halogen_Query_HalogenM.bindHalogenM)(Control_Monad_State_Class.put(Halogen_Query_HalogenM.monadStateHalogenM)(newCube))(function () {
                    return Control_Bind.discard(Control_Bind.discardUnit)(Halogen_Query_HalogenM.bindHalogenM)(Control_Monad_Eff_Class.liftEff(Halogen_Query_HalogenM.monadEffHalogenM(Control_Monad_Aff.monadEffAff))(Control_Monad_Eff_Console.log("tick")))(function () {
                        return Control_Applicative.pure(Halogen_Query_HalogenM.applicativeHalogenM)(v.value0);
                    });
                });
            });
        };
        if (v instanceof IncAngVelocity) {
            return Control_Bind.bind(Halogen_Query_HalogenM.bindHalogenM)(Control_Monad_State_Class.get(Halogen_Query_HalogenM.monadStateHalogenM))(function (v1) {
                return Control_Bind.discard(Control_Bind.discardUnit)(Halogen_Query_HalogenM.bindHalogenM)((function () {
                    if (v1.forward) {
                        return Control_Monad_State_Class.modify(Halogen_Query_HalogenM.monadStateHalogenM)(function (c) {
                            if (v.value0 instanceof X) {
                                var $97 = {};
                                for (var $98 in c) {
                                    if ({}.hasOwnProperty.call(c, $98)) {
                                        $97[$98] = c[$98];
                                    };
                                };
                                $97.angVel = (function () {
                                    var $94 = {};
                                    for (var $95 in c.angVel) {
                                        if ({}.hasOwnProperty.call(c.angVel, $95)) {
                                            $94[$95] = c["angVel"][$95];
                                        };
                                    };
                                    $94.xa = v1.angVel.xa + accelerateBy + v1.speed;
                                    return $94;
                                })();
                                return $97;
                            };
                            if (v.value0 instanceof Y) {
                                var $103 = {};
                                for (var $104 in c) {
                                    if ({}.hasOwnProperty.call(c, $104)) {
                                        $103[$104] = c[$104];
                                    };
                                };
                                $103.angVel = (function () {
                                    var $100 = {};
                                    for (var $101 in c.angVel) {
                                        if ({}.hasOwnProperty.call(c.angVel, $101)) {
                                            $100[$101] = c["angVel"][$101];
                                        };
                                    };
                                    $100.ya = v1.angVel.ya + accelerateBy + v1.speed;
                                    return $100;
                                })();
                                return $103;
                            };
                            if (v.value0 instanceof Z) {
                                var $109 = {};
                                for (var $110 in c) {
                                    if ({}.hasOwnProperty.call(c, $110)) {
                                        $109[$110] = c[$110];
                                    };
                                };
                                $109.angVel = (function () {
                                    var $106 = {};
                                    for (var $107 in c.angVel) {
                                        if ({}.hasOwnProperty.call(c.angVel, $107)) {
                                            $106[$107] = c["angVel"][$107];
                                        };
                                    };
                                    $106.za = v1.angVel.za + accelerateBy + v1.speed;
                                    return $106;
                                })();
                                return $109;
                            };
                            throw new Error("Failed pattern match at Cube line 179, column 13 - line 182, column 70: " + [ v.value0.constructor.name ]);
                        });
                    };
                    return Control_Monad_State_Class.modify(Halogen_Query_HalogenM.monadStateHalogenM)(function (c) {
                        if (v.value0 instanceof X) {
                            var $116 = {};
                            for (var $117 in c) {
                                if ({}.hasOwnProperty.call(c, $117)) {
                                    $116[$117] = c[$117];
                                };
                            };
                            $116.angVel = (function () {
                                var $113 = {};
                                for (var $114 in c.angVel) {
                                    if ({}.hasOwnProperty.call(c.angVel, $114)) {
                                        $113[$114] = c["angVel"][$114];
                                    };
                                };
                                $113.xa = (v1.angVel.xa - accelerateBy) + v1.speed;
                                return $113;
                            })();
                            return $116;
                        };
                        if (v.value0 instanceof Y) {
                            var $122 = {};
                            for (var $123 in c) {
                                if ({}.hasOwnProperty.call(c, $123)) {
                                    $122[$123] = c[$123];
                                };
                            };
                            $122.angVel = (function () {
                                var $119 = {};
                                for (var $120 in c.angVel) {
                                    if ({}.hasOwnProperty.call(c.angVel, $120)) {
                                        $119[$120] = c["angVel"][$120];
                                    };
                                };
                                $119.ya = (v1.angVel.ya - accelerateBy) + v1.speed;
                                return $119;
                            })();
                            return $122;
                        };
                        if (v.value0 instanceof Z) {
                            var $128 = {};
                            for (var $129 in c) {
                                if ({}.hasOwnProperty.call(c, $129)) {
                                    $128[$129] = c[$129];
                                };
                            };
                            $128.angVel = (function () {
                                var $125 = {};
                                for (var $126 in c.angVel) {
                                    if ({}.hasOwnProperty.call(c.angVel, $126)) {
                                        $125[$126] = c["angVel"][$126];
                                    };
                                };
                                $125.za = (v1.angVel.za - accelerateBy) + v1.speed;
                                return $125;
                            })();
                            return $128;
                        };
                        throw new Error("Failed pattern match at Cube line 187, column 13 - line 190, column 70: " + [ v.value0.constructor.name ]);
                    });
                })())(function () {
                    return Control_Applicative.pure(Halogen_Query_HalogenM.applicativeHalogenM)(v.value1);
                });
            });
        };
        if (v instanceof ForwardToggle) {
            return Control_Bind.bind(Halogen_Query_HalogenM.bindHalogenM)(Control_Monad_State_Class.get(Halogen_Query_HalogenM.monadStateHalogenM))(function (v1) {
                return Control_Bind.discard(Control_Bind.discardUnit)(Halogen_Query_HalogenM.bindHalogenM)(Control_Monad_State_Class.modify(Halogen_Query_HalogenM.monadStateHalogenM)(function (c) {
                    var $138 = {};
                    for (var $139 in c) {
                        if ({}.hasOwnProperty.call(c, $139)) {
                            $138[$139] = c[$139];
                        };
                    };
                    $138.forward = (function () {
                        if (v1.forward) {
                            return false;
                        };
                        return true;
                    })();
                    return $138;
                }))(function () {
                    return Control_Applicative.pure(Halogen_Query_HalogenM.applicativeHalogenM)(v.value0);
                });
            });
        };
        if (v instanceof VelocityIncrement) {
            return Control_Bind.bind(Halogen_Query_HalogenM.bindHalogenM)(Control_Monad_State_Class.get(Halogen_Query_HalogenM.monadStateHalogenM))(function (v1) {
                return Control_Bind.discard(Control_Bind.discardUnit)(Halogen_Query_HalogenM.bindHalogenM)(Control_Monad_State_Class.modify(Halogen_Query_HalogenM.monadStateHalogenM)(function (c) {
                    var $143 = {};
                    for (var $144 in c) {
                        if ({}.hasOwnProperty.call(c, $144)) {
                            $143[$144] = c[$144];
                        };
                    };
                    $143.speed = v1.speed + 25.0;
                    return $143;
                }))(function () {
                    return Control_Applicative.pure(Halogen_Query_HalogenM.applicativeHalogenM)(v.value0);
                });
            });
        };
        if (v instanceof VelocityDecrement) {
            return Control_Bind.bind(Halogen_Query_HalogenM.bindHalogenM)(Control_Monad_State_Class.get(Halogen_Query_HalogenM.monadStateHalogenM))(function (v1) {
                return Control_Bind.discard(Control_Bind.discardUnit)(Halogen_Query_HalogenM.bindHalogenM)(Control_Monad_State_Class.modify(Halogen_Query_HalogenM.monadStateHalogenM)(function (c) {
                    var $148 = {};
                    for (var $149 in c) {
                        if ({}.hasOwnProperty.call(c, $149)) {
                            $148[$149] = c[$149];
                        };
                    };
                    $148.speed = v1.speed - 25.0;
                    return $148;
                }))(function () {
                    return Control_Applicative.pure(Halogen_Query_HalogenM.applicativeHalogenM)(v.value0);
                });
            });
        };
        if (v instanceof AddCube) {
            return Control_Bind.bind(Halogen_Query_HalogenM.bindHalogenM)(Control_Monad_State_Class.get(Halogen_Query_HalogenM.monadStateHalogenM))(function (v1) {
                return Control_Bind.discard(Control_Bind.discardUnit)(Halogen_Query_HalogenM.bindHalogenM)(Control_Monad_State_Class.modify(Halogen_Query_HalogenM.monadStateHalogenM)(function (c) {
                    var $153 = {};
                    for (var $154 in c) {
                        if ({}.hasOwnProperty.call(c, $154)) {
                            $153[$154] = c[$154];
                        };
                    };
                    $153.count = v1.count + 1.0;
                    return $153;
                }))(function () {
                    return Control_Applicative.pure(Halogen_Query_HalogenM.applicativeHalogenM)(v.value0);
                });
            });
        };
        if (v instanceof RemoveCube) {
            return Control_Bind.bind(Halogen_Query_HalogenM.bindHalogenM)(Control_Monad_State_Class.get(Halogen_Query_HalogenM.monadStateHalogenM))(function (v1) {
                return Control_Bind.discard(Control_Bind.discardUnit)(Halogen_Query_HalogenM.bindHalogenM)(Control_Monad_State_Class.modify(Halogen_Query_HalogenM.monadStateHalogenM)(function (c) {
                    var $158 = {};
                    for (var $159 in c) {
                        if ({}.hasOwnProperty.call(c, $159)) {
                            $158[$159] = c[$159];
                        };
                    };
                    $158.count = v1.count - 1.0;
                    return $158;
                }))(function () {
                    return Control_Applicative.pure(Halogen_Query_HalogenM.applicativeHalogenM)(v.value0);
                });
            });
        };
        throw new Error("Failed pattern match at Cube line 153, column 12 - line 238, column 18: " + [ v.constructor.name ]);
    };
    return Halogen_Component.component(Halogen_HTML_Core.bifunctorHTML)({
        initialState: Data_Function["const"](initCube),
        render: renderView,
        "eval": $$eval,
        receiver: Data_Function["const"](Data_Maybe.Nothing.value)
    });
})();
module.exports = {
    X: X,
    Y: Y,
    Z: Z,
    viewBoxSize: viewBoxSize,
    viewCenter: viewCenter,
    frameRate: frameRate,
    oneDegInRad: oneDegInRad,
    tenDegInRad: tenDegInRad,
    accelerateBy: accelerateBy,
    dampenPercent: dampenPercent,
    initCube: initCube,
    Tick: Tick,
    IncAngVelocity: IncAngVelocity,
    ForwardToggle: ForwardToggle,
    VelocityIncrement: VelocityIncrement,
    VelocityDecrement: VelocityDecrement,
    AddCube: AddCube,
    RemoveCube: RemoveCube,
    cubes: cubes,
    rotateShape: rotateShape,
    rotate: rotate,
    anglePerFrame: anglePerFrame,
    dampenAngVelocity: dampenAngVelocity,
    renderView: renderView
};
